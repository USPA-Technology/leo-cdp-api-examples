<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Wheel of Fortune</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        canvas {
            border: 2px solid #000;
            position: relative;
        }

        #spin-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #arrow {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid red;
            z-index: 10;
        }
    </style>
</head>

<body>
    <div id="arrow"></div>
    <canvas id="wheel" width="500" height="500"></canvas>
    <button id="spin-btn">Spin</button>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spin-btn');

        const prizes = [
            "10.000 VND voucher PNJ",
            "50.000 VND voucher PNJ",
            "100.000 VND voucher PNJ",
            "500.000 VND voucher PNJ",
            "Xiaomi Redmi S2 64GB",
            "Chúc bạn may mắn lần sau!",
            "Yamaha Exciter 150GP 2019",
            "Chúc bạn may mắn lần sau!"
        ];

        const colors = ["#FF5733", "#33FF57", "#3357FF", "#FF33A6", "#FFBD33", "#8D33FF", "#33FFF9", "#FF6F33"];
        let currentAngle = 0;
        let prizeMap = [];

        function buildPrizeMap() {
            const numberOfSlices = prizes.length;
            const sliceAngle = 360 / numberOfSlices;

            prizes.forEach((prize, index) => {
                const startAngle = index * sliceAngle;
                const endAngle = startAngle + sliceAngle;
                prizeMap.push({ startAngle, endAngle, prize });
            });

            console.log("Prize Map:", prizeMap);
        }

        function drawWheel() {
            const numberOfSlices = prizes.length;
            const sliceAngle = (2 * Math.PI) / numberOfSlices;

            prizes.forEach((prize, index) => {
                const startAngle = index * sliceAngle;
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, canvas.height / 2);
                ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, startAngle, endAngle);
                ctx.fillStyle = colors[index % colors.length];
                ctx.fill();
                ctx.strokeStyle = "#000";
                ctx.stroke();

                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#000";
                ctx.font = "16px Arial";
                ctx.fillText(prize, canvas.width / 2 - 20, 10);
                ctx.restore();
            });
        }

        function getPrize(angle) {
            const normalizedAngle = (angle % 360 + 360) % 360; // Normalize to 0-359
            for (const entry of prizeMap) {
                if (normalizedAngle >= entry.startAngle && normalizedAngle < entry.endAngle) {
                    return entry.prize;
                }
            }
            return null; // Fallback, should not occur if prizeMap is built correctly
        }

        function spinWheel() {
            const spinAngle = Math.random() * 360 + 720; // Minimum two full rotations
            const targetAngle = (currentAngle + spinAngle) % 360;
            currentAngle += spinAngle;

            let animationDuration = 3000;
            const startTime = performance.now();

            function animateWheel(currentTime) {
                const elapsedTime = currentTime - startTime;
                const easing = Math.min(elapsedTime / animationDuration, 1);
                const currentSpin = easing * spinAngle;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate((currentAngle - currentSpin) * Math.PI / 180);
                ctx.translate(-canvas.width / 2, -canvas.height / 2);
                drawWheel();
                ctx.restore();

                if (elapsedTime < animationDuration) {
                    requestAnimationFrame(animateWheel);
                } else {
                    const prize = getPrize(targetAngle);
                    alert(`You won: ${prize}`); // Show result
                }
            }

            requestAnimationFrame(animateWheel);
        }

        buildPrizeMap();
        drawWheel();

        spinButton.addEventListener('click', spinWheel);
    </script>
</body>

</html>
