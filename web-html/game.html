<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <base href="https://asunaxran.github.io/vongquaymayman/" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <title>Vòng quay may mắn</title>

    <!-- Game CSS -->
    <link rel="stylesheet" href="https://asunaxran.github.io/vongquaymayman/css/style.css">

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

</head>

<body>

    <div id="app">
        <div class="frame">
            <button id="login_btn"> Đăng nhập </button>
            <div class="box-square">
                <div class="box-content">
                    <div id="wheel">
                        <img id="wheel-check" src="imgs/img_vongquay.png" alt="Vòng quay">
                        <a href="#" id="turn-btn">
                            <img id="turn-img" src="imgs/btn_quay.png" alt="Quay">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // (1) CDP_EVENT_OBSERVER: load JavaScript code for [Game: Vòng quay may mắn]
        (function () {
            // Observer ID
            window.leoObserverId = "4KaMq3UZcLbx7HMoK5fgYL";
            // CDN of JS
            window.leoObserverLogDomain = "datahub4dcdp.bigdatavietnam.org";
            window.leoObserverCdnDomain = "cdn.jsdelivr.net/gh/USPA-Technology/leo-cdp-static-files@v0.8.9.33";
            // Data Touchpoint Metadata 
            window.srcTouchpointName = encodeURIComponent(document.title);
            window.srcTouchpointUrl = encodeURIComponent(location.href);
            // the main proxy CDP JS
            var leoproxyJsPath = '/js/leo-observer/leo.proxy.min.js';
            var src = location.protocol + '//' + window.leoObserverCdnDomain + leoproxyJsPath;
            var jsNode = document.createElement('script');
            jsNode.async = true;
            jsNode.defer = true;
            jsNode.src = src;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jsNode, s);
        }
        )();
        var parseDataUTM = window.parseDataUTM || function () {
            if (location.search.indexOf('utm_') > 0) {
                var search = location.search.substring(1);
                var json = decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"');
                return JSON.parse('{"' + json + '"}');
            }
        }
        // (2) CDP EVENT OBSERVER: set-up all event tracking functions
        var LeoObserver = {
        };
        // (2.1) function to track View Event "PageView"
        LeoObserver.recordEventPageView = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordViewEvent("page-view", eventData);
        }
        // (2.2) function to track Action Event "ClickDetails"
        LeoObserver.recordEventClickDetails = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordActionEvent("click-details", eventData);
        }
        // (2.3) function to track Action Event "SubmitContact"
        LeoObserver.recordEventSubmitContact = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordActionEvent("submit-contact", eventData);
        }
        // (2.4) function to track View Event "GameLoaded"
        LeoObserver.recordEventGameLoaded = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordViewEvent("game-loaded", eventData);
        }
        // (2.5) function to track Action Event "RegisterAccount"
        LeoObserver.recordEventRegisterAccount = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordActionEvent("register-account", eventData);
        }
        // (2.6) function to track Action Event "UserLogin"
        LeoObserver.recordEventUserLogin = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordActionEvent("user-login", eventData);
        }
        // (2.7) function to track Action Event "AskQuestion"
        LeoObserver.recordEventAskQuestion = function (eventData) {
            eventData = eventData ? eventData : {
            };
            LeoObserverProxy.recordActionEvent("ask-question", eventData);
        }
        // (2.8) function to track Conversion Event "Purchase"
        LeoObserver.recordEventPurchase = function (eventData, shoppingCartItems, transactionId, transactionValue, currencyCode) {
            // need 5 params
            eventData = typeof eventData === "object" ? eventData : {
            };
            shoppingCartItems = typeof shoppingCartItems === "object" ? shoppingCartItems : [];
            transactionId = typeof transactionId === "string" ? transactionId : "";
            transactionValue = typeof transactionValue === "number" ? transactionValue : 0;
            currencyCode = typeof currencyCode === "string" ? currencyCode : "USD";
            LeoObserverProxy.recordConversionEvent("purchase", eventData, transactionId, shoppingCartItems, transactionValue, currencyCode);
        }
    </script>

    <!-- Game -->
    <script>

        var currentDeg = 0;
        var prevDeg = 0;
        var randDeg = 0;
        var turns = 0;
        var transDuration = 3;

        const gifts = [
            "Yamaha Exciter 150GP 2019",
            "Chúc bạn may mắn lần sau!",
            "50.000 VND tặng vào VTC Pay",
            "Xiaomi Redmi S2 64GB",
            "100.000 VND tặng vào VTC Pay",
            "500.000 VND tặng vào VTC Pay",
            "10.000 VND tặng vào VTC Pay",
        ];


        function onGameHtmlReady() {

            console.log("game loaded");
            // Game loaded
            LeoObserver.recordEventGameLoaded(parseDataUTM());
        }

        // CDP EVENT OBSERVER is ready
        function leoObserverProxyReady(session) {
            // auto tracking page-view when CDP JS is ready
            LeoObserver.recordEventPageView(parseDataUTM());
            // simulate game loaded
            setTimeout(function () {
                $("#wheel-check").ready(onGameHtmlReady);
            }, 2000)
        }

        function trackGetGift(selectedGift) {
            console.log('tracking trackGetGift ' + selectedGift)
        }

        function setupUserLogin() {
            $('#login_btn').click(function () {

                // Handle login form submission
                Swal.fire({
                    title: 'Login',
                    html: $('#login-popup').html(),
                    confirmButtonText: 'Submit',
                    focusConfirm: false,
                    preConfirm: () => {
                        var form = $('#swal2-html-container');
                        const name = form.find('input[name="name"]').val().trim();
                        const mobile =  form.find('input[name="mobile"]').val().trim();
                        const errorMessage = "Vui lòng kiểm tra lại thông tin của bạn.";

                        // Validate inputs
                        if (!name || !mobile || !/^[0-9]{10,15}$/.test(mobile)) {
                            Swal.showValidationMessage(errorMessage);
                            return false;
                        }

                        // Return valid data
                        return { name, mobile };
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        console.log('User Data:', result.value);
                    }
                });
            });


        }

        // Function to get gift
        function getGift(val) {
            let selectedGift = null;

            if ((val >= 0 && val <= 10) || (val >= 321 && val <= 370)) {
                selectedGift = gifts[0];
            } else if (val >= 11 && val <= 61) {
                selectedGift = "Chúc bạn may mắn lần sau"; // Example of using variable
            } else if (val >= 62 && val <= 113) {
                selectedGift = gifts[2];
            } else if (val >= 114 && val <= 164) {
                selectedGift = gifts[3];
            } else if (val >= 165 && val <= 216) {
                selectedGift = gifts[4];
            } else if (val >= 217 && val <= 267) {
                selectedGift = gifts[5];
            } else if (val >= 268 && val <= 320) {
                selectedGift = gifts[6];
            } else {
                selectedGift = gifts[0];
            }

            trackGetGift(selectedGift);
            return selectedGift;
        }

        function setupGame() {

            setupUserLogin();

            $("#turn-btn").click(function (e) {
                e.preventDefault();
                currentDeg += Math.floor(Math.random() * 10000) + 500;
                turns = Math.floor((currentDeg - prevDeg) / 360);
                prevDeg = currentDeg;
                transDuration = turns / 10 + 2;
                $("#wheel-check").css({
                    transform: "rotate(" + currentDeg + "deg)",
                    "transition-duration": transDuration + "s",
                }
                );
                setTimeout(() => {
                    Swal.fire(getGift(currentDeg % 360), "Phần thưởng", "success");
                }, transDuration * 1000 + 500);
            });
        }

        $(document).ready(setupGame);
    </script>


    <!-- Hidden Login Form -->
    <div style="display: none;" id="login-popup">

        <form id="login-form">
            <label for="name">Tên:</label>
            <input type="text"name="name" required placeholder="Nhập tên của bạn" /><br><br>

            <label for="mobile">Số điện thoại:</label>
            <input type="tel" name="mobile" required placeholder="Nhập số điện thoại" /><br><br>
        </form>

    </div>

    <!-- Hidden get-gift Form -->
    <div style="display: none;" id="get-gift-popup">
      
        <form id="get-gift--form">
            <label for="age">Tuổi:</label>
            <input type="number" id="age" name="age" required /><br><br>

            <label for="location">Địa chỉ:</label>
            <input type="text" id="location" name="location" required /><br><br>

            <label for="gender">Giới tính:</label>
            <select id="gender" name="gender" required>
                <option value="">Select</option>
                <option value="male">Nam</option>
                <option value="female">Nữ</option>
                <option value="other">Khác</option>
            </select><br><br>
        </form>
    </div>
</body>

</html>